var ContractsListing,router,UploadModal,vm;const GetContractsListApiUrl="/api/HomeApi/GetContractViewerModel?",AddContractApiUrl="/api/HomeApi/AddNewContract",UploadContractApiUrl="/api/HomeApi/UploadScan",GetScanPdfApiUrl="/Scan/index?contractId=",GetDocumentApiUrl="/Document/GetDocument?",CurrentHost=window.location.protocol+"//"+window.location.host;ContractsListing={name:"ContractsListing",template:"#Contracts-Listing-Template",props:{contracts:{},currentpage:0,totalpages:0,totalrows:0},data:function(){return{}},methods:{ChangePageClicked:function(n){this.$emit("changepageclicked",n)},UploadContractClicked:function(n){this.$emit("uploadcontractclicked",n)},OpenScanPdfClicked:function(n){this.$emit("openscannedpdfclicked",n)},PrintDocumentClicked:function(n){this.$emit("printdocumentclicked",n)}}};router=new VueRouter({mode:"history",base:"Home/Index",root:window.location.href,routes:[{name:"default",path:"/",component:ContractsListing}]});Vue.use(VueRouter);Vue.use(VeeValidate);Vue.component("printdocument-modal",{template:"#printdocument-modal-template",props:["docnames","contractid"],data:function(){return{SelectedDoc:""}},methods:{OpenPrintPage:function(){var n=CurrentHost+GetDocumentApiUrl+"contractid="+this.contractid+"&docName="+this.$data.SelectedDoc;window.open(n)}}});UploadModal={name:"upload-modal",template:"#uploadscanned-modal-template",computed:{progressStyle:function(){return{width:this.$data.Progress+"%"}}},props:["contractid"],data:function(){return{options:{method:"post",uploadMultiple:!1,url:UploadContractApiUrl+"?contractId="+this.contractid,paramName:"file",maxFilesize:10,maxFiles:1,acceptedFiles:{extensions:["application/pdf"],message:"You are uploading an invalid file"}},Uploading:0,Progress:0,Filename:"",Status:"",Uploadable:!0}},methods:{addedfile:function(n){this.$data.Uploading=1;this.$data.Filename=n.name},uploadcompleted:function(n,t,i){this.$data.Status=t!="success"?i.status==500?"Server error!":i.response:"Success!";this.$data.Uploading=0;this.$data.Progress=0;this.$data.Uploadable=!1},uploadprogresschange:function(n){this.$data.Progress=n}}};Vue.component("upload-modal",UploadModal);Vue.component("newcontract-modal",{template:"#addcontract-modal-template",data:function(){return{Name:"",Phone:"",Address:"",TaxId:"",Commission:0,Status:"",AddingContract:0}},methods:{AddContract:function(){var n=this;n.$validator.validateAll().then(t=>{if(!t){n.SetStatus("Errors in inputs.");return}n.SetStatus("Adding contracts....");n.DoAddContract()})},DoAddContract:function(){var n=this,t;n.$data.AddingContract=1;t=CurrentHost+AddContractApiUrl;console.log(t);axios.post(t,{Name:n.$data.Name,Address:n.$data.Address,Phone:n.$data.Phone,TaxId:n.$data.TaxId,Commission:n.$data.Commission,Effective:!0,UserId:1,ScannedContractUrl:null}).then(function(){n.SetStatus("Success!");n.$data.AddingContract=0;n.ClearData()}).catch(function(t){n.SetStatus("Fail to add contract, status: "+t.response.status);n.$data.AddingContract=0;n.ClearData()})},ClearData:function(){this.$data.Name="";this.$data.Phone="";this.$data.Address="";this.$data.TaxId="";this.$data.Commission=0;this.errors.clear();this.$validator.reset()},SetStatus:function(n){this.$data.Status=n}}});vm=new Vue({el:"#app",router:router,mounted:function(){this.Innit()},data:{ContractViewerModel:[],ContractModels:[],TotalRows:0,TotalPages:0,OnPage:0,DocumentNames:[],SelectedFilterValue:2,SearchString:"",ShowAddContractModal:!1,ShowUploadModal:!1,ShowDocumentModal:!1,UploadToContractId:-1,ShowDocumentForId:-1},computed:{HasFilter:function(){var n=this.$data.SelectedFilterValue,t=this.$data.SearchString;return n!==undefined&&t.length>0?!0:!1},ContractsListingApiPrefix:function(){return CurrentHost+GetContractsListApiUrl},GetCurrentContractsListingApi:function(){var t=this.$data.OnPage;(t<1||t==null)&&(t=1);var i=this.$data.SelectedFilterValue,r=this.$data.SearchString,n="page="+t;return n=n+"&filter="+this.HasFilter,this.HasFilter&&(this.$data.SelectedFilterValue=i,this.$data.SearchString=r,n=n+"&type="+i+"&contains="+r),this.ContractsListingApiPrefix+n}},watch:{$route:function(n){this.$data.SearchString=n.query.contains;this.$data.SelectedFilterValue=n.query.type;this.$data.OnPage=n.query.page;this.LoadContracts(this.GetCurrentContractsListingApi)}},methods:{Innit:function(){var n=router.history.current.query.page,t,i;(n<1||n==null)&&(n=1);t=router.history.current.query.type;t==undefined&&(t=2);i=router.history.current.query.contains;i==undefined&&(i="");this.$data.OnPage=n;this.$data.SearchString=i;this.$data.SelectedFilterValue=t;this.LoadContracts(this.GetCurrentContractsListingApi)},LoadContracts:function(n){var t=this;axios.get(n).then(function(n){t.$data.ContractViewerModel=n.data;t.$data.ContractModels=n.data.ContractModels;t.$data.DocumentNames=n.data.DocumentNames;t.UpdatePagination()}).catch(function(n){console.log(n);console.log("Failed to fetch model")})},UpdatePagination:function(){this.$data.TotalPages=this.$data.ContractViewerModel.TotalPages;this.$data.TotalRows=this.$data.ContractViewerModel.TotalRows},DataRowClicked:function(n){alert(n.Name)},AddNewContractClicked:function(){this.$data.ShowAddContractModal=!0},OpenNewScanPage:function(n){var t=CurrentHost+GetScanPdfApiUrl+n;window.open(t)},ShowUploadModalHandler:function(n){this.$data.ShowUploadModal=!0;this.$data.UploadToContractId=n},PrinDocumentModalHandler:function(n){this.$data.ShowDocumentModal=!0;this.$data.ShowDocumentForId=n},OnCloseUploadModal:function(){this.$data.ShowUploadModal=!1;this.LoadContracts(this.GetCurrentContractsListingApi)},SearchButtonClicked:function(){this.$data.OnPage=1;router.push({path:"/",query:this.GetSearchQuery(1)})},PageNavClicked:function(n){this.$data.OnPage=n;router.push({path:"/",query:this.GetSearchQuery(n)})},GetSearchQuery:function(n){return{page:n,filter:this.HasFilter,type:this.$data.SelectedFilterValue,contains:this.$data.SearchString}}}});